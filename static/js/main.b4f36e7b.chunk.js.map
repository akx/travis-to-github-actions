{"version":3,"sources":["converter/utils.ts","converter/languageSetup.ts","converter/steps.ts","converter/strategy.ts","converter/os.ts","converter/job.ts","converter/env.ts","converter/cache.ts","converter/converter.ts","converter/prelude.ts","frontend/components/ResultMessagesList.tsx","frontend/components/ResultView.tsx","frontend/components/Header.tsx","frontend/App.tsx","frontend/examples/babelpy.travis.yml.ts","frontend/index.tsx"],"names":["arrayfy","x","defaultValue","undefined","Array","isArray","permutations","choices","callback","prefix","length","c","slice","concat","isEmpty","obj","Object","keys","removeEmptyObjects","map","newObject","forEach","key","newValue","convertPerLanguageSetup","ctx","travis","matrixAspects","steps","language","python","push","name","uses","with","convertPythonSetup","messages","node_js","type","text","convertNodeSetup","stepSources","sourceWarnings","after_success","before_install","convertJobStepArray","sourceName","stepModifier","stepsGenerated","command","run","warning","convertJobSteps","env","environmentVariables","fromEntries","v","getStepEnvFragment","maybeInjectEnv","step","includes","expandMatrixIntoIncludes","jobContext","finalMatrixAspects","$env$","environmentVariableCombinations","aspectKeys","aspectValues","values","combo","include","index","value","assign","buildStrategy","matrix","consumePackageManagerObject","addons","packages","spec","Set","convertOperatingSystemSetup","aptPackages","size","if","from","sort","join","convertApt","homebrewPackages","convertHomebrew","convertJob","os","every","e","envStr","vars","split","s","match","exec","convertEnvironmentVariables","cache","directories","path","convertCache","strategy","convertToGHA","travisYaml","trim","yaml","safeLoad","github","on","branches","pull_request","jobs","makeContext","sudo","dist","processPrelude","remainingTravis","safeDump","noCompatMode","ResultMessagesList","status","ResultView","result","error","direction","flex","margin","as","placeholder","readOnly","style","height","Header","align","justify","wrap","padding","bg","color","mr","mt","base","md","border","target","href","App","React","useState","setTravisYaml","conversionResult","useMemo","exc","toString","errorDetail","onClick","onChange","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.b4f36e7b.chunk.js","sourcesContent":["export function arrayfy<T>(\n  x: T | T[] | undefined,\n  defaultValue: readonly T[] = []\n): T[] {\n  if (x === undefined) return [...defaultValue];\n  if (!Array.isArray(x)) return [x];\n  return x;\n}\n\nexport function permutations<T>(\n  choices: readonly T[][],\n  callback: (combo: readonly T[]) => void,\n  prefix: readonly T[] = []\n) {\n  if (!choices.length) {\n    return callback(prefix);\n  }\n  for (var c = 0; c < choices[0].length; c++) {\n    permutations(\n      choices.slice(1),\n      callback,\n      (prefix || []).concat(choices[0][c])\n    );\n  }\n}\n\nexport function deleteIfEmpty<T extends object>(\n  obj: T | undefined,\n  key: keyof T\n) {\n  if (\n    obj &&\n    typeof obj[key] === \"object\" &&\n    Object.keys(obj[key]).length === 0\n  ) {\n    delete obj[key];\n    return true;\n  }\n  return false;\n}\n\nexport function isEmpty(obj: any): boolean {\n  return (\n    (typeof obj === \"object\" && Object.keys(obj).length === 0) ||\n    (Array.isArray(obj) && obj.length === 0)\n  );\n}\n\nexport function removeEmptyObjects(obj: any): any {\n  if (Array.isArray(obj)) {\n    return obj.map(removeEmptyObjects);\n  }\n  if (typeof obj === \"object\") {\n    const newObject: Record<string, any> = {};\n    Object.keys(obj).forEach((key) => {\n      const newValue = removeEmptyObjects(obj[key]);\n      if (!isEmpty(newValue)) {\n        newObject[key] = newValue;\n      }\n    });\n    return newObject;\n  }\n  return obj;\n}\n","/* eslint-disable no-template-curly-in-string */\nimport { JobContext } from \"./types\";\nimport { arrayfy } from \"./utils\";\n\nfunction convertPythonSetup(ctx: JobContext) {\n  const { travis, matrixAspects, steps } = ctx;\n  if (travis.language === \"python\" || travis.python) {\n    matrixAspects[\"python-version\"] = arrayfy<string>(travis.python, [\"3.8\"]);\n    steps.push({\n      name: \"Set up Python ${{ matrix.python-version }}\",\n      uses: \"actions/setup-python@v2\",\n      with: {\n        \"python-version\": \"${{ matrix.python-version }}\",\n      },\n    });\n    delete travis.python;\n    delete travis.language;\n  }\n}\n\nfunction convertNodeSetup(ctx: JobContext) {\n  const { travis, messages, steps, matrixAspects } = ctx;\n\n  if (travis.language === \"node_js\" || travis.node_js) {\n    // TODO: parse used versions\n    messages.push({\n      type: \"info\",\n      text:\n        \"Node.js versions are not yet parsed from the Travis configuration.\",\n    });\n    matrixAspects[\"node-version\"] = [\"14.x\"];\n    steps.push({\n      name: \"Set up Node.js ${{ matrix.node-version }}\",\n      uses: \"actions/setup-node@v1\",\n      with: {\n        \"node-version\": \"${{ matrix.node-version }}\",\n      },\n    });\n    delete travis.node_js;\n    delete travis.language;\n  }\n}\n\nexport function convertPerLanguageSetup(ctx: JobContext) {\n  convertPythonSetup(ctx);\n  convertNodeSetup(ctx);\n}\n","import { JobContext } from \"./types\";\nimport { Step } from \"./types/github-workflow\";\nimport { arrayfy } from \"./utils\";\nimport { Travis } from \"./types/travis\";\n\nfunction getStepEnvFragment(ctx: JobContext) {\n  if (!Object.keys(ctx.environmentVariables).length) {\n    return undefined;\n  }\n  return Object.fromEntries(\n    Object.keys(ctx.environmentVariables).map((v) => [v, `$\\{{ matrix.${v} }}`])\n  );\n}\n\nconst stepSources: (keyof Travis)[] = [\n  \"before_install\",\n  \"install\",\n  \"before_script\",\n  \"script\",\n  \"after_script\",\n  \"after_success\",\n];\n\nconst sourceWarnings: Record<string, string> = {\n  after_success: \"after_success actions were concatenated\",\n  before_install: \"before_install actions were prepended\",\n};\n\nfunction convertJobStepArray(\n  ctx: JobContext,\n  sourceName: keyof Travis,\n  stepModifier: (step: Step) => Step\n) {\n  // TODO: would be nice to add comments/names for non-script steps\n  let stepsGenerated = 0;\n  arrayfy(ctx.travis[sourceName]).forEach((command) => {\n    if (typeof command !== \"string\") {\n      ctx.messages.push({\n        type: \"warning\",\n        text: `Entry not a string in ${sourceName}: ${command}`,\n      });\n      return;\n    }\n    ctx.steps.push(\n      stepModifier({\n        run: command,\n      })\n    );\n    stepsGenerated++;\n  });\n  if (stepsGenerated > 0) {\n    delete ctx.travis[sourceName];\n    const warning = sourceWarnings[sourceName];\n    if (warning) {\n      ctx.messages.push({\n        type: \"warning\",\n        text: warning,\n      });\n    }\n  }\n  return stepsGenerated;\n}\n\nexport function convertJobSteps(ctx: JobContext) {\n  const env = getStepEnvFragment(ctx);\n\n  const maybeInjectEnv = (step: Step): Step => {\n    // If the step looks like it uses an environment variable, inject all of them into the step\n    if (env && step.run && step.run.includes(\"$\")) {\n      step.env = env;\n    }\n    return step;\n  };\n\n  ctx.steps.push({\n    uses: \"actions/checkout@v2\",\n  });\n\n  for (let source of stepSources) {\n    convertJobStepArray(ctx, source, maybeInjectEnv);\n  }\n}\n","import { JobContext } from \"./types\";\nimport { Strategy } from \"./types/github-workflow\";\nimport { permutations } from \"./utils\";\n\nfunction expandMatrixIntoIncludes(jobContext: JobContext) {\n  const finalMatrixAspects: Record<string, any[]> = {\n    ...jobContext.matrixAspects,\n    $env$: jobContext.environmentVariableCombinations,\n  };\n  const aspectKeys = Object.keys(finalMatrixAspects);\n  const aspectValues = Object.values(finalMatrixAspects);\n  const includes: any[] = [];\n  permutations(aspectValues, (combo) => {\n    const include: Record<string, string> = {};\n    aspectKeys.forEach((key, index) => {\n      const value = combo[index];\n      if (key === \"$env$\" && typeof value === \"object\") {\n        Object.assign(include, value);\n      } else {\n        include[key] = value;\n      }\n    });\n    includes.push(include);\n  });\n  return includes;\n}\n\nexport function buildStrategy(jobContext: JobContext): Strategy {\n  if (jobContext.environmentVariableCombinations.length) {\n    return {\n      matrix: {\n        include: expandMatrixIntoIncludes(jobContext),\n      },\n    };\n  }\n  return {\n    matrix: {\n      ...jobContext.matrixAspects,\n    },\n  };\n}\n","import { JobContext } from \"./types\";\nimport { arrayfy } from \"./utils\";\nimport { Addons } from \"./types/travis\";\n\nfunction consumePackageManagerObject(\n  addons: Addons | undefined,\n  key: \"apt\" | \"homebrew\"\n): Set<string> | undefined {\n  if (!addons) {\n    return;\n  }\n  let spec = addons[key];\n  let packages: Set<string> | undefined;\n  if (spec) {\n    if (spec === true || spec === false) {\n      delete addons[key]; // Nothing to do\n    } else if (Array.isArray(spec)) {\n      packages = new Set(arrayfy(spec));\n      delete addons[key]; // Consume\n    } else if (typeof spec === \"string\") {\n      packages = new Set([spec]);\n      delete addons[key]; // Consume\n    } else {\n      packages = new Set(arrayfy(spec.packages));\n      delete spec.packages;\n    }\n  }\n  return packages;\n}\n\nfunction convertApt(ctx: JobContext) {\n  const aptPackages = consumePackageManagerObject(ctx.travis.addons, \"apt\");\n  if (aptPackages && aptPackages.size) {\n    ctx.steps.push({\n      name: \"Install dependencies (Ubuntu)\",\n      if: \"runner.os == 'Linux'\",\n      run: [\n        \"sudo apt-get update\",\n        \"sudo apt-get install -y \" + Array.from(aptPackages).sort().join(\" \"),\n      ].join(\"\\n\"),\n    });\n  }\n}\n\nfunction convertHomebrew(ctx: JobContext) {\n  const homebrewPackages = consumePackageManagerObject(\n    ctx.travis.addons,\n    \"homebrew\"\n  );\n  if (homebrewPackages && homebrewPackages.size) {\n    ctx.steps.push({\n      name: \"Install dependencies (macOS)\",\n      if: \"runner.os == 'macOS'\",\n      run: [\n        \"brew update\",\n        \"brew install \" + Array.from(homebrewPackages).sort().join(\" \"),\n      ].join(\"\\n\"),\n    });\n  }\n}\n\nexport function convertOperatingSystemSetup(ctx: JobContext) {\n  convertApt(ctx);\n  convertHomebrew(ctx);\n}\n","/* eslint-disable no-template-curly-in-string */\nimport { ConvertContext, JobContext } from \"./types\";\nimport { Job } from \"./types/github-workflow\";\nimport { convertPerLanguageSetup } from \"./languageSetup\";\nimport { convertCache } from \"./cache\";\nimport { convertEnvironmentVariables } from \"./env\";\nimport { convertJobSteps } from \"./steps\";\nimport { buildStrategy } from \"./strategy\";\nimport { convertOperatingSystemSetup } from \"./os\";\n\nexport function convertJob(ctx: ConvertContext): Job {\n  const jobContext: JobContext = {\n    ...ctx,\n    steps: [],\n    environmentVariableCombinations: [],\n    environmentVariables: {},\n    matrixAspects: {\n      os: [\"ubuntu-18.04\"],\n    },\n  };\n  convertEnvironmentVariables(jobContext);\n  convertOperatingSystemSetup(jobContext);\n  convertPerLanguageSetup(jobContext);\n  convertCache(jobContext);\n  convertJobSteps(jobContext);\n  return {\n    \"runs-on\": \"${{ matrix.os }}\",\n    strategy: buildStrategy(jobContext),\n    steps: jobContext.steps,\n  };\n}\n","import { JobContext } from \"./types\";\n\nexport function convertEnvironmentVariables(ctx: JobContext) {\n  if (\n    Array.isArray(ctx.travis.env) &&\n    ctx.travis.env.every((e) => typeof e === \"string\")\n  ) {\n    ctx.travis.env.forEach((envStr) => {\n      if (typeof envStr !== \"string\") return;\n      const vars = Object.fromEntries(\n        envStr.split(/\\s+/).map((s) => {\n          const match = /^(.+?)=(.+)$/.exec(s);\n          return match ? [match[1], match[2]] : [s, \"1\"];\n        })\n      );\n      ctx.environmentVariableCombinations.push(vars);\n      Object.keys(vars).forEach((v) => {\n        ctx.environmentVariables[v] = true;\n      });\n    });\n    delete ctx.travis.env;\n  }\n}\n","/* eslint-disable no-template-curly-in-string */\nimport { JobContext } from \"./types\";\nimport { arrayfy } from \"./utils\";\n\nexport function convertCache(ctx: JobContext) {\n  const { travis, steps, messages } = ctx;\n  if (!travis.cache) {\n    return;\n  }\n  if (travis.cache === true) {\n    return;\n  }\n  if (!travis.cache.directories) {\n    return;\n  }\n  steps.push({\n    name: \"Cache multiple paths\",\n    uses: \"actions/cache@v2\",\n    with: {\n      path: arrayfy(travis.cache.directories).join(\"\\n\"),\n      key: \"${{ runner.os }}-${{ hashFiles('TODO') }}\",\n    },\n  });\n  messages.push({\n    type: \"info\",\n    text: \"Please revise the cache key for `actions/cache`.\",\n  });\n  delete travis.cache;\n}\n","/* eslint-disable no-template-curly-in-string */\nimport { safeDump, safeLoad } from \"js-yaml\";\nimport { Travis } from \"./types/travis\";\nimport { ConvertContext, ConvertResult } from \"./types\";\nimport { GithubWorkflow } from \"./types/github-workflow\";\nimport { processPrelude } from \"./prelude\";\nimport { convertJob } from \"./job\";\nimport { isEmpty, removeEmptyObjects } from \"./utils\";\n\nfunction makeContext(travisYaml: string): ConvertContext {\n  const travis = (safeLoad(travisYaml) as unknown) as Travis;\n  const github: GithubWorkflow = {\n    name: \"Converted Workflow\",\n    on: {\n      push: {\n        branches: [\"master\"],\n      },\n      pull_request: {\n        branches: [\"master\"],\n      },\n    },\n    jobs: {},\n  };\n  return { travis, messages: [], github };\n}\n\nexport function convertToGHA(travisYaml: string): ConvertResult {\n  travisYaml = travisYaml.trim();\n  if (!travisYaml.length) {\n    return { yaml: \"\", messages: [] };\n  }\n  const ctx = makeContext(travisYaml);\n  const { travis, messages, github } = ctx;\n  processPrelude(ctx);\n  github.jobs[\"build\"] = convertJob(ctx);\n  const remainingTravis = removeEmptyObjects(travis);\n\n  return {\n    yaml: safeDump(github, {noCompatMode: true}),\n    messages,\n    remainingTravis: !isEmpty(remainingTravis)\n      ? safeDump(remainingTravis, {noCompatMode: true})\n      : undefined,\n  };\n}\n","import { ConvertContext } from \"./types\";\n\nexport function processPrelude(ctx: ConvertContext) {\n  const { travis, messages } = ctx;\n  if (travis.sudo) {\n    messages.push({ type: \"info\", text: \"Ignoring `sudo`\" });\n  }\n  delete travis.sudo;\n  if (travis.dist) {\n    messages.push({ type: \"info\", text: \"Ignoring `dist`\" });\n  }\n  delete travis.dist;\n}\n","import { ConvertMessage } from \"../../converter/types\";\nimport { Alert, AlertDescription, AlertIcon } from \"@chakra-ui/react\";\nimport React from \"react\";\n\nexport function ResultMessagesList({\n  messages,\n}: {\n  messages: ConvertMessage[];\n}) {\n  if (!messages.length) return null;\n  return (\n    <div>\n      {messages.map(({ type, text }, index) => (\n        <Alert status={type} key={`${text} ${index}`}>\n          <AlertIcon />\n          <AlertDescription>{text}</AlertDescription>\n        </Alert>\n      ))}\n    </div>\n  );\n}\n","import { ConvertResult } from \"../../converter/types\";\nimport {\n  Alert,\n  AlertDescription,\n  AlertIcon,\n  Flex,\n  Heading,\n  Textarea,\n} from \"@chakra-ui/react\";\nimport { ResultMessagesList } from \"./ResultMessagesList\";\nimport React from \"react\";\n\nexport function ResultView({ result }: { result: ConvertResult }) {\n  if (result && result.error) {\n    return (\n      <div>\n        <Alert status=\"error\">\n          <AlertIcon />\n          <AlertDescription>\n            Conversion failed: ${result.error}\n          </AlertDescription>\n        </Alert>\n      </div>\n    );\n  }\n\n  return (\n    <>\n      <Flex direction=\"column\" flex={1} margin={2}>\n        <Heading as=\"h4\" size=\"md\">\n          GitHub Actions YAML\n        </Heading>\n        <Textarea\n          placeholder=\"GitHub Actions YAML will appear here\"\n          readOnly\n          value={result.yaml}\n          style={{ height: \"auto\" }}\n          flex={1}\n        />\n        <ResultMessagesList messages={result.messages} />\n      </Flex>\n      {result.remainingTravis ? (\n        <Flex direction=\"column\" flex={1} margin={2}>\n          <Heading as=\"h4\" size=\"md\">\n            Unconverted Travis configuration\n          </Heading>\n          <Alert status=\"info\">\n            <AlertIcon />\n            <AlertDescription>\n              The app doesn't yet know how to handle whatever remains in this\n              box.\n              <br />\n              If you can help, please open a PR on GitHub ☝️\n            </AlertDescription>\n          </Alert>\n          <Textarea\n            placeholder=\"GitHub Actions YAML will appear here\"\n            readOnly\n            value={result.remainingTravis}\n            style={{ height: \"auto\" }}\n            flex={1}\n          />\n        </Flex>\n      ) : null}\n    </>\n  );\n}\n","import { Box, Button, Flex, Heading } from \"@chakra-ui/react\";\nimport React from \"react\";\n\nconst Header = () => (\n  <Flex\n    as=\"nav\"\n    align=\"center\"\n    justify=\"space-between\"\n    wrap=\"wrap\"\n    padding=\"1.5rem\"\n    bg=\"blue.500\"\n    color=\"white\"\n  >\n    {\" \"}\n    <Flex align=\"center\" mr={5}>\n      <Heading as=\"h1\" size=\"lg\">\n        Travis to GitHub Actions converter\n      </Heading>\n    </Flex>\n    <Box mt={{ base: 4, md: 0 }}>\n      <Button\n        bg=\"transparent\"\n        border=\"1px\"\n        as=\"a\"\n        target=\"_blank\"\n        href=\"https://github.com/akx/travis-to-github-actions\"\n      >\n        Contribute on GitHub\n      </Button>\n    </Box>\n  </Flex>\n);\nexport default Header;\n","import { Flex, Heading, Textarea } from \"@chakra-ui/react\";\nimport React from \"react\";\nimport \"./App.css\";\nimport { convertToGHA } from \"../converter/converter\";\nimport { ResultView } from \"./components/ResultView\";\nimport Header from \"./components/Header\";\nimport babelPyExample from \"./examples/babelpy.travis.yml\";\n\nfunction useTravisConversion(yaml: string) {\n  return React.useMemo(() => {\n    try {\n      return convertToGHA(yaml);\n    } catch (exc) {\n      return {\n        yaml: \"\",\n        messages: [],\n        error: exc.toString(),\n        errorDetail: exc,\n      };\n    }\n  }, [yaml]);\n}\n\nfunction App() {\n  const [travisYaml, setTravisYaml] = React.useState(\"\");\n  const conversionResult = useTravisConversion(travisYaml);\n  return (\n    <Flex direction=\"column\" flex={1}>\n      <Header />\n      <Flex padding={5} flex={1}>\n        <Flex flex={2} direction=\"column\" margin={2}>\n          <Flex justify=\"space-between\">\n            <Heading as=\"h4\" size=\"md\">\n              Input Travis.yml\n            </Heading>\n            {/* eslint-disable-next-line jsx-a11y/anchor-is-valid */}\n            <a href=\"#\" onClick={() => setTravisYaml(babelPyExample)}>\n              Load example\n            </a>\n          </Flex>\n          <Textarea\n            placeholder=\"Paste a travis.yml here\"\n            value={travisYaml}\n            onChange={(e) => setTravisYaml(e.target.value)}\n            style={{ height: \"auto\" }}\n            flex={1}\n          />\n        </Flex>\n        <Flex flex={3} direction=\"row\">\n          <ResultView result={conversionResult} />\n        </Flex>\n      </Flex>\n    </Flex>\n  );\n}\n\nexport default App;\n","/* eslint-disable no-template-curly-in-string */\nconst content =\n  'dist: xenial\\nlanguage: python\\n\\n# Use travis docker infrastructure for greater speed\\nsudo: false\\n\\ncache:\\n  directories:\\n  - cldr\\n  - \"$HOME/.cache/pip\"\\n  - \"$HOME/.pyenv\"\\n\\nmatrix:\\n  include:\\n    - os: linux\\n      python: 2.7\\n      env:\\n      - PYTEST_VERSION=4.3.1\\n    - os: linux\\n      python: 2.7\\n      env:\\n      - CDECIMAL=m3-cdecimal\\n      - PYTEST_VERSION=4.3.1\\n    - os: linux\\n      dist: trusty\\n      python: pypy\\n      env:\\n      - PYTEST_VERSION=4.3.1\\n    - os: linux\\n      dist: trusty\\n      python: pypy3\\n      env:\\n      - PYTEST_VERSION=6.1.2\\n    - os: linux\\n      python: 3.4\\n      env:\\n      - PYTEST_VERSION=4.3.1\\n    - os: linux\\n      python: 3.5\\n      env:\\n      - PYTHON_TEST_FLAGS=-bb\\n      - PYTEST_VERSION=6.1.2\\n    - os: linux\\n      python: 3.6\\n      env:\\n      - PYTEST_VERSION=6.1.2\\n    - os: linux\\n      python: 3.7\\n      env:\\n      - PYTEST_VERSION=6.1.2\\n    - os: linux\\n      python: 3.8\\n      env:\\n      - PYTEST_VERSION=6.1.2\\n\\ninstall:\\n  - bash .ci/deps.${TRAVIS_OS_NAME}.sh\\n  - pip install --upgrade pip\\n  - pip install --upgrade $CDECIMAL pytest==$PYTEST_VERSION pytest-cov freezegun==0.3.12\\n  - pip install --editable .\\n\\nscript:\\n  - make test-cov\\n  - bash .ci/deploy.${TRAVIS_OS_NAME}.sh\\n\\nnotifications:\\n  email: false\\n  irc:\\n    channels:\\n      - \"chat.freenode.net#pocoo\"\\n    on_success: change\\n    on_failure: always\\n    use_notice: true\\n    skip_join: true';\nexport default content;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport { ChakraProvider } from \"@chakra-ui/react\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <ChakraProvider>\n      <App />\n    </ChakraProvider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}